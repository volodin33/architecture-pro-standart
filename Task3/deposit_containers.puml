@startuml
' C4-PlantUML: Container diagram
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title MVP «Открытие депозитов»

System_Ext(ibank, "Интернет-банк", "Заявка + СМС подтверждение")
System_Ext(crm, "CRM / Колл-центр", "Лиды/заявки, статусы")
System_Ext(sms_core, "Ядро СМС", "Отправка/проверка СМС")
System_Ext(abs, "АБС", "Открытие депозита/учёт/статусы")
Person(customer_new, "Новый клиент", "Подаёт заявку на сайте")
Person(customer_ib, "Клиент интернет-банка", "Подаёт заявку из интернет-банка")
Person(call_mgr, "Менеджер колл-центра", "Работает с заявками в CRM")
Person(rate_mgr, "Сотрудник, ведущий ставки", "Загружает ставки (XLS)")
Person(bo_mgr, "Менеджер бэк-офиса депозитов", "Обрабатывает заявки")
System_Ext(site, "Сайт банка", "Витрина депозитов + форма заявки")

System_Boundary(mvp, "MVP «Открытие депозитов»") {
  Container(api, "API заявок на депозиты", "Web API",    "Приём заявок, статусы, бизнес-логика, публикация команд и обработка событий через Kafka")
  ContainerDb(db, "База заявок и ставок", "СУБД",    "Заявки, статусы, история изменений, ставки и версии загрузок")
  Container(bo_ui, "Рабочее место бэк-офиса (MVP)", "Web UI (внутренний)",    "Очередь заявок, просмотр/обработка, импорт ставок из XLS")
  Container(abs_adapter, "Адаптер АБС", "Интеграционный сервис",    "Преобразование команд/событий в интеграцию с АБС и обратно")
  Container(crm_adapter, "Адаптер CRM", "Интеграционный сервис",    "Передача заявок/статусов в CRM и получение результатов")
  Container(sms_adapter, "Адаптер СМС", "Интеграционный сервис",    "Отправка/проверка СМС через ядро СМС; публикация результатов")
  ContainerQueue(kafka, "Kafka", "Брокер сообщений",    "Канал обмена сообщениями между API заявок и интеграционными адаптерами")
}

Rel(customer_new, site, "Подаёт заявку", "HTTPS")
Rel(site, api, "Создание заявки, получение ставок/статуса", "HTTPS (TLS)")
Rel(customer_ib, ibank, "Подаёт заявку, вводит СМС-код", "HTTPS")
Rel(ibank, api, "Создание заявки, запрос СМС, проверка кода, статус", "HTTPS (TLS)")
Rel(bo_mgr, bo_ui, "Обрабатывает заявки", "HTTPS (внутренний)")
Rel(rate_mgr, bo_ui, "Загружает XLS со ставками", "HTTPS (внутренний)")
Rel(bo_ui, api, "Список/детали/смена статуса, импорт ставок", "HTTPS (TLS)")
Rel(api, db, "Чтение/запись", "SQL")
Rel(api, kafka, "Публикует команды и читает события", "Kafka")
Rel(abs_adapter, kafka, "Читает команды и публикует события", "Kafka")
Rel(crm_adapter, kafka, "Читает команды и публикует события", "Kafka")
Rel(sms_adapter, kafka, "Читает команды и публикует события", "Kafka")
Rel(abs_adapter, abs, "Интеграция с АБС", "API/интеграция")
Rel(crm_adapter, crm, "Интеграция с CRM", "API/интеграция")
Rel(call_mgr, crm, "Работает с заявками", "UI")
Rel(sms_adapter, sms_core, "СМС операции", "Интеграция")

@enduml
