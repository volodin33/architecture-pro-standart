@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title MVP «Открытие депозитов» (с интеграцией с АБС)

Person(customer_new, "Новый клиент", "Сайт")
Person(customer_ib, "Клиент интернет-банка", "Интернет-банк")
Person(call_mgr, "Менеджер колл-центра", "CRM")
Person(rate_mgr, "Сотрудник, ведущий ставки", "Загрузка XLS")

System_Ext(site, "Сайт банка", "Витрина депозитов + заявка")
System_Ext(crm, "CRM / Колл-центр", "Заявки/лиды")
System_Ext(sms_core, "Ядро СМС", "СМС-коды")
System_Ext(abs, "АБС", "Открытие депозита/условия")
System_Ext(ibank, "Интернет-банк", "Заявка + СМС")
Person(bo_mgr, "Менеджер бэк-офиса депозитов", "Бэк-офис")

System_Boundary(mvp, "MVP «Открытие депозитов»") {
  Container(api, "API заявок на депозиты", "Web API",  "Приём заявок, статусы, выдача ставок, инициирование СМС, запуск процесса открытия")
  ContainerDb(db, "База заявок и ставок", "MS SQL / Oracle",  "Заявки, статусы, история, ставки и версии загрузок")
  Container(sms_adapter, "Адаптер СМС", "Интеграционный модуль",  "Отправка/проверка СМС без доработки ядра")
  Container(crm_adapter, "Адаптер CRM", "Интеграционный модуль",  "Передача заявок в CRM и получение результата")
  Container(abs_adapter, "Адаптер АБС", "Интеграционный модуль",  "Создание поручения/заявки на открытие депозита, получение статуса/результата")
  Container(bo_ui, "Рабочее место бэк-офиса (MVP)", "Web UI (внутренний)",  "Очередь заявок, просмотр, фиксация статусов, импорт ставок из XLS")
}

Rel(customer_new, site, "Подаёт заявку", "HTTPS")
Rel(customer_ib, ibank, "Подаёт заявку, вводит СМС-код", "HTTPS")
Rel(site, api, "Ставки, создание заявки", "HTTPS (TLS)")
Rel(ibank, api, "Создание заявки, СМС, статус", "HTTPS (TLS)")
Rel(api, db, "Чтение/запись", "SQL")
Rel(api, sms_adapter, "Отправить/проверить СМС", "Внутренний API")
Rel(sms_adapter, sms_core, "СМС операции", "Интеграция")
Rel(api, crm_adapter, "Передать заявку/получить результат", "Внутренний API")
Rel(crm_adapter, crm, "Интеграция", "API/интеграция")
Rel(call_mgr, crm, "Работает с заявками", "UI")
Rel(api, abs_adapter, "Создать поручение/заявку на открытие, получить статус/результат", "Внутренний API")
Rel(abs_adapter, abs, "Интеграция с АБС", "API/интеграция")
Rel(bo_mgr, bo_ui, "Обрабатывает заявки", "HTTPS (внутренний)")
Rel(bo_ui, api, "Список/детали/смена статуса, импорт ставок", "HTTPS (TLS)")
Rel(bo_mgr, abs, "Подтверждает условия и открывает депозит", "UI/процесс")
Rel(rate_mgr, bo_ui, "Загружает XLS со ставками", "UI")

@enduml
